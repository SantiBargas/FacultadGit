close all; clear all; more off;

xnode = [
  0.0000000000000000, 0.0000000000000000; #nodo 1
  0.0000000000000000, 0.1666666666666667; #nodo 2
  0.0000000000000000, 0.3333333333333333; #nodo 3
  0.0000000000000000, 0.5000000000000000; #nodo 4
  0.0000000000000000, 0.6666666666666666; ##nodo 5
  0.0000000000000000, 0.8333333333333333; #nodo 6
  0.0000000000000000, 1.0000000000000000; ##nodo 7

  0.1666666666666667, 0.0000000000000000; #nodo 8
  0.1666666666666667, 0.1666666666666667; #nodo 9
  0.1666666666666667, 0.3333333333333333; #nodo 10
  0.1666666666666667, 0.5000000000000000; #nodo 11
  0.1666666666666667, 0.6666666666666666; #nodo 12
  0.1666666666666667, 0.8333333333333333; #nodo 13
  0.1666666666666667, 1.0000000000000000; #nodo 14

  0.3333333333333333, 0.0000000000000000; #nodo 15
  0.3333333333333333, 0.1666666666666667; #nodo 16
  0.3333333333333333, 0.3333333333333333; #nodo 17
  0.3333333333333333, 0.5000000000000000; #nodo 18
  0.3333333333333333, 0.6666666666666666; #nodo 19
  0.3333333333333333, 0.8333333333333333; #nodo 20
  0.3333333333333333, 1.0000000000000000; #nodo 21

  0.5000000000000000, 0.0000000000000000; #nodo 22
  0.5000000000000000, 0.1666666666666667; #nodo 23
  0.5000000000000000, 0.3333333333333333; #nodo 24

  0.6666666666666666, 0.0000000000000000; #nodo 25
  0.6666666666666666, 0.1666666666666667; #nodo 26
  0.6666666666666666, 0.3333333333333333; #nodo 27

  0.8333333333333333, 0.0000000000000000; #nodo 28
  0.8333333333333333, 0.1666666666666667; #nodo 29
  0.8333333333333333, 0.3333333333333333; #nodo 30

  1.0000000000000000, 0.0000000000000000; #nodo 31
  1.0000000000000000, 0.1666666666666667; #nodo 32
  1.0000000000000000, 0.3333333333333333; #nodo 33
];

##plot(xnode(:,1),xnode(:,2),'o');

icone = [
       1,      8,      9,      2;
       2,      9,     10,      3;
       3,     10,     11,      4;
       4,     11,     12,      5;
       5,     12,     13,      6;
       6,     13,     14,      7;
       8,     15,     16,      9;
       9,     16,     17,     10;
      10,     17,     18,     11;
      11,     18,     19,     12;
      12,     19,     20,     13;
      13,     20,     21,     14;
      15,     22,     23,     16;
      16,     23,     24,     17;
      22,     25,     26,     23;
      23,     26,     27,     24;
      25,     28,     29,     26;
      26,     29,     30,     27;
      28,     31,     32,     29;
      29,     32,     33,     30;
];

DIR = [
       1, 20.0000000000000000;
       1, 100.0000000000000000;
       2, 20.0000000000000000;
       3, 20.0000000000000000;
       4, 20.0000000000000000;
       5, 20.0000000000000000;
       6, 20.0000000000000000;
       7, 20.0000000000000000;
       7, 100.0000000000000000;
       8, 100.0000000000000000;
      14, 100.0000000000000000;
      15, 100.0000000000000000;
      21, 100.0000000000000000;
      22, 100.0000000000000000;
      25, 100.0000000000000000;
      28, 100.0000000000000000;
      31, 20.0000000000000000;
      31, 100.0000000000000000;
      32, 20.0000000000000000;
      33, 20.0000000000000000;
];

NEU = [
      18, 0.0000000000000000, 2;
      19, 0.0000000000000000, 2;
      20, 0.0000000000000000, 2;
      21, 0.0000000000000000, 2;
      24, 0.0000000000000000, 3;
      27, 0.0000000000000000, 3;
      30, 0.0000000000000000, 3;
      33, 0.0000000000000000, 3;
];

ROB = [
];

disp('---------------------------------------------------------------');
disp('Inicializando modelo de datos...');

model.nnodes = size(xnode,1);

model.k = [
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
    1.0000000000000000;
];

model.c = [
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
    0.0000000000000000;
];

model.G = [
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
    1000.0000000000000000;
];

% Esquema Temporal: [0] Explícito, [1] Implícito, [X] Estacionario
model.ts = 1;

% Parámetros para esquemas temporales
model.rho = 1.0000000000000000;
model.cp = 1.0000000000000000;
model.maxit =          500;
model.tol = 1.000000e-06;
model.dt = 0.0500000000000000;

% Condición inicial
model.PHI_n = mean(DIR(:,2))*ones(model.nnodes,1);

disp('Iniciando el método numérico...');

% Llamada principal al Método de Diferencias Finitas
[PHI,Q] = fdm2d(xnode, icone, DIR, NEU, ROB, model);

disp('Finalizada la ejecución del método numérico.');

disp('---------------------------------------------------------------');
disp('Iniciando el post-procesamiento...');

% mode ---> modo de visualización:
%           [0] 2D - Con malla
%           [1] 3D - Con malla
%           [2] 2D - Sin malla
%           [3] 3D - Sin malla
% graph --> tipo de gráfica:
%           [0] Temperatura (escalar)
%           [1] Flujo de Calor (vectorial)
%           [2] Flujo de Calor eje-x (escalar)
%           [3] Flujo de Calor eje-y (escalar)
%           [4] Magnitud de Flujo de Calor (escalar)
mode = 0;
graph = 0;
fdm2d_graph_mesh(full(PHI),Q,xnode,icone,mode,graph);

disp('Finalizado el post-procesamiento.');

[max_temp, idx] = max(PHI(:))
[nodo, iteracion] = ind2sub(size(PHI), idx);
maxEstacionario = max(PHI(:,202))

##################################################
disp("\n Temperatura en x=0 y=0 NODO 1");
T1=PHI(32,:);

% Vector de tiempos
dt = 0.05;
times = 0:dt:(length(T1)-1)*dt;
% Crear la matriz emparejada
resultadoT11 = [times', T1']
################################################
##
####SUMAMOS 1 EN CADA ITERACION PQ ARRANCA EN tiempo 0
disp("\n Temperatura en x=0 y=1/6 hasta x=1 y=1/6");
disp("T=1 -> 1/dt -> 1/0.05 -> 20 en la iteracion 20  se encuentra para t=1 ")
T1_1=PHI(2,21)
disp("\n T=5 -> 1/dt -> 5/0.05 -> 100 en la iteracion 100 se encuentra para t=5 ")
T1_5=PHI(2,101)
disp("\n T=5 -> 1/dt -> 10/0.05 -> 200 en la iteracion 200 se encuentra para t=10 ")
T1_10=PHI(2,201)

##T26=PHI(26,:);
##resultadoT26 = [times', T26']

% Tiempo en segundos
t_final = 5;
dt = 0.05;
t_idx = t_final/dt + 1; % Índice de tiempo
nodos_interes = [2, 9, 16, 23, 26, 29, 32,33]; % Nodos de interés
temp_en_nodos_t1s = PHI(nodos_interes, t_idx);% Extracción de temperaturas en esos nodos

% Mostrar los resultados
for i = 1:length(nodos_interes)
    fprintf('Temperatura en el nodo %d a t=5s: %.6f\n', nodos_interes(i), temp_en_nodos_t1s(i));
end

